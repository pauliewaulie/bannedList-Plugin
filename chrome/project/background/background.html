<html>
<script src="../js/jquery-1.7.1.min_plus_highlight.js" type="text/javascript"></script>
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28859929-1']);
    _gaq.push(['_trackPageview']);

    (function() { // See: http://code.google.com/chrome/extensions/tut_analytics.html
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
<script type="text/javascript">
    $(document).ready(function () {
        chrome.extension.onRequest.addListener( function( request, sender, sendResponse) {
            if (request.method == "getOptions") {
                if ( localStorage.length == 0) {    // Set defaults!
                    localStorage["extras.politics.andrew1"] = true;
                }
                sendResponse({method: "getOptions", options: localStorage});
            } else if (request.method == "notify") {
                var theNotif = webkitNotifications.createNotification('../img/icon48.png', request.heading, request.msg);
                theNotif.show();
            } else {
                sendResponse({}); // snub them.
            }
        });

        function clickSubmit( inInfo, inTab) {
	    chrome.tabs.sendRequest( inTab.id, {
	        method: "showSubmitOptions",
	        pageUrl: inInfo.pageUrl,
		phrase: inInfo.selectionText
	    }, function (response) {
	        if ( response.ok != "true") {
	            alert('Error!');
	        }
	    });
        }

        var menuId = chrome.contextMenus.create({"title": 'Submit new phrase...', "contexts":['selection'], "onclick": clickSubmit});
    });
</script>
</html>